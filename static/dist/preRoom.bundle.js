(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{49:function(t,e,n){var s=n(17);t.exports=(s.default||s).template({1:function(t,e,n,s,o){return"Join"},3:function(t,e,n,s,o){return"Create"},5:function(t,e,n,s,o){return'\t\t<div class="row">\n\n\t\t\t<div class="col-8 d-flex text-center flex-column mx-auto ">\n\t\t\t\t<label>Magnet URI:</label>\n\t\t\t\t<input id="magneturi" type="text" class="form-control mb-1" placeholder="magnet:?...">\n\t\t\t\t<h4 class="text-muted">OR</h4>\n\t\t\t\t<div id="dropzone" class="d-flex justify-content-center" style="height:40vh;border-style:dashed;border-color:grey;border-radius:20px">\n\t\t\t\t\t<h1 class="display-4 text-muted align-self-center">Drag And Drop Torrent File</h1>\n\t\t\t\t</div>\n\t\t\t\t<h4 id="torrentname" class="text-success"></h4>\n\t\t\t</div>\n\t\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){var r,l=null!=e?e:t.nullContext||{},i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n <div class="container">\n\t\t<div class="row" style="height:30vh">\n\t\t\t\n\t\t\t<div class="col-auto align-self-end mx-auto">\n\t\t\t\t<label>Display Name:</label>\n\t\t\t\t<input id="displayname" type="text" class="form-control ">\n\t\t\t</div>\n\n\t\t</div>\n\t\t<div class="row">\n\n\t\t\t<div class="col mx-auto">\n\t\t\t\t<div class="text-center">\n\t\t\t\t<button id="enteroom" disabled=true type="button" class="btn btn-outline-success btn-lg float-none mt-2 mb-3">'+(null!=(r=i(n,"if").call(l,null!=e?i(e,"isJoin"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:15,column:114},end:{line:15,column:153}}}))?r:"")+"</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n"+(null!=(r=i(n,"unless").call(l,null!=e?i(e,"isJoin"):e,{name:"unless",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:20,column:2},end:{line:33,column:13}}}))?r:"")+"\t</div>\n"},useData:!0})},50:function(t,e,n){var s=n(17);t.exports=(s.default||s).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){return'\t<div class="container-fluid" style="height:100vh;">\n\t\t<div class="d-flex flex-column h-100 p-1" >\n\t\t<div class="row mb-1">\n\t\t\t<div class="col-8">\n\t\t\t\t<video id="videlem" class="video-js vjs-default-skin vjs-big-play-centered" controls ></video>\n\t\t\t</div>\n\n\t\t\t<div class="col-4">\n\t\t\t\t<div class="card h-100">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t<h3 class="card-title">Watchers :</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="list-group">\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="row flex-grow-1">\n\t\t\t<div class="col-8">\n\t\t\t\t<div class="card h-100" >\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t<h3 class="card-title">Chat :</h3>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="col-4 align-self-center">\n\t\t\t\t<button type="button" class="btn btn-outline-secondary btn-lg mx-auto"> Mute </button>\n\t\t\t\t<button type="button" class="btn btn-outline-danger btn-lg mx-auto"> Disconnect </button>\n\t\t\t</div>\n\t\t</div>\n\t\t</div>\n\t</div>\n'},useData:!0})},56:function(t,e,n){"use strict";n.r(e);var s=n(40),o=n.n(s),r=n(47),l=n.n(r),i=n(23),a=n.n(i),c=n(48),d=n.n(c);var u=class{constructor(t,e,n){this.fchannel=n;this.pc=new d.a({initiator:t,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpTransform:t=>(t.replace("useinbandfec=1","useinbandfec=1; maxaveragebitrate=28000"),t),trickle:!0,stream:e}),this.pc.on("signal",t=>{n.send(JSON.stringify(t))}),this.fchannel.onmessage=t=>{const e=JSON.parse(t);this.pc.signal(e)}}};var h=class{constructor(t,e){this.id=t,this.ref=e,this.onmessage=null,this.ref.on("child_added",t=>{const e=t.val();e.id!==this.id&&(this.onmessage&&this.onmessage(e.data),t.ref.remove())})}send(t){this.ref.push({id:this.id,data:t}).then(()=>{}).catch(t=>{console.error("Error writing new message to Firebase Database",t)})}};var p=class{constructor(t,e,n,s,o=null,r=null){this.uid=t,this.stream=s,console.log(this.stream),this.name=e,this.torrent=o,this.connList={},this.remoteuser=null,this.oncontrolmessage=null,this.onmessage=null,this.onremoteuserset=null,this.ontorrentlearned=null,this.onremotestreamadded=null,this.ondataremoved=null,null===r?(this.roomRef=n.push(),this.roomRef.set({torrent:this.torrent,remoteiswith:this.uid}).then(()=>{this.ontorrentlearned&&this.ontorrentlearned(this.torrent),this.onremoteuserset&&this.onremoteuserset()}),this.roomRef.onDisconnect().remove(),this.id=this.roomRef.key):(this.roomRef=n.child(r),this.roomRef.child("torrent").once("value",t=>{this.torrent=t.val(),this.ontorrentlearned&&this.ontorrentlearned(this.torrent)})),this.roomRef.child("remoteiswith").on("value",t=>{t.val()===this.uid&&(0===Object.keys(this.connList).length?this.roomRef.onDisconnect().remove():this.roomRef.child("remoteiswith").onDisconnect().set(Object.keys(this.connList)[0]),this.onremoteuserset&&this.onremoteuserset()),this.remoteuser=t.val()}),this.currentUser=this.roomRef.child("connList").child(this.uid),this.currentUser.set(this.name),this.currentUser.onDisconnect().remove(),this.roomRef.child("connList").on("child_added",t=>{if(t.key===this.uid)return;0===Object.keys(this.connList).length&&(this.roomRef.onDisconnect().cancel(),this.currentUser.onDisconnect().remove()),this.connList[t.key]={name:t.val()},this.uid===this.remoteuser&&this.roomRef.child("remoteiswith").onDisconnect().set(Object.keys(this.connList)[0]);const e=[t.key,this.uid];e.sort();const n=this.roomRef.child(`channels/${e[0]}/${e[1]}`),s=this.uid===e[0],o=new u(s,this.stream,new h(this.uid,n));o.pc.on("error",t=>{console.log(t)}),o.pc.on("connect",()=>{this.connList[t.key].peer=o,o.fchannel.onmessage=null,o.pc.on("data",e=>{e=JSON.parse(e),console.log(e,this.remoteuser,t.key,t.key===this.remoteuser&&"control"===e.type),t.key===this.remoteuser&&"control"===e.type&&(this.oncontrolmessage?(console.log("calling console"),this.oncontrolmessage(e.data)):this.onmessage&&this.onmessage({name:t.val(),data:e.data}))})}),o.pc.on("stream",t=>{this.onremotestreamadded&&this.onremotestreamadded(t)})}),this.roomRef.child("connList").on("child_removed",t=>{t.key!==this.uid&&(this.connList[t.key].peer.pc.destroy(),this.connList[t.key].peer=null,delete this.connList[t.key],console.log(this.connList),this.ondataremoved&&this.ondataremoved(t.key))})}changeRemote(t){this.roomRef.child("remoteiswith").set(t),this.onremoteuserset&&this.remoteuserset(),this.roomReF.child("remoteiswith").onDisconnect().cancel()}broadcast(t){const e=JSON.stringify({type:"message",data:t});Object.values(this.connList).forEach(t=>{console.log(t),t.peer.pc.send(e)})}control(t){const e=JSON.stringify({type:"control",data:t});Object.values(this.connList).forEach(t=>{console.log(t),t.peer.pc.send(e)})}},m=n(49),y=n.n(m),v=n(51),g=n(50),f=n.n(g);var b=class{constructor(t,e,n){this.vidElem=e,this.playerStore=n,this.Player=new Plyr(this.vidElem,{controls:'\n<div class="plyr__controls">\n<button type="button" class="plyr__control remote-only" aria-label="Play" data-plyr="play">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-pause"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-play"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Pause</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Play</span>\n</button>\n<div class="plyr__progress__container">\n<div class="plyr__progress">\n<input class="remote-only" data-plyr="seek" type="range" min="0" max="100" step="0.01" value="0" aria-label="Seek">\n<progress class="plyr__progress__buffer" min="0" max="100" value="0">% buffered</progress>\n<span role="tooltip" class="plyr__tooltip">00:00</span>\n</div>\n</div>\n<button type="button" class="plyr__control" aria-label="Mute" data-plyr="mute">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-muted"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-volume"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Unmute</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Mute</span>\n</button>\n<div class="plyr__volume">\n<input data-plyr="volume" type="range" min="0" max="1" step="0.05" value="1" autocomplete="off" aria-label="Volume">\n</div>\n<div class="plyr__controls__item plyr__time--current plyr__time" aria-label="Current time"></div>\n<button type="button" class="plyr__control" data-plyr="fullscreen">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-exit-fullscreen"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-enter-fullscreen"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Exit fullscreen</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Enter fullscreen</span>\n</button>\n</div>\n',clickToPlay:!1}),this.hideControls(),this.playerStore.subscribe(()=>{const t=this.playerStore.getState();switch(console.log(t.isremote),t.isremote){case!0:this.showControls();break;default:this.hideControls()}if(!t.isremote){switch(t.playerState.paused){case!0:console.log("pausing"),this.Player.pause();break;default:console.log("playing"),this.Player.play()}this.Player.currentTime=t.playerState.currtime}}),this.Player.on("play",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.Player.on("pause",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.Player.on("seeked",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.client=new a.a,this.client.add(t,t=>{t.files.find(t=>t.name.endsWith(".mp4")).renderTo(this.vidElem,{controls:!1}),console.log(this.Player),this.client.on("error",t=>{console.log(t)})})}hideControls(){document.querySelectorAll(".remote-only").forEach(t=>{t.style.display="none",console.log("Hiding Controls")})}showControls(){document.querySelectorAll(".remote-only").forEach(t=>{t.style.display="",console.log("Showing Controls")})}};const _={isremote:!1,torrent:null,playerState:{paused:!0,currtime:0}};function w(t=_.playerState,e){return e}var S=function(t=_,e){switch(e.type){case"CHANGE_STATE":return{...t,playerState:w(t.playerState,e.playerState)};case"SET_REMOTE":return{...t,isremote:!t.isremote};case"TORRENT_LEARNED":return{...t,torrent:e.torrent};default:return t}};var k=function(t,e){const n=Object(v.a)(S);t.innerHTML=f()(),e.ontorrentlearned=t=>{new b(t,document.getElementById("videlem"),n)},e.onremoteuserset=()=>{n.dispatch({type:"SET_REMOTE"})},e.onremotestreamadded=e=>{console.log(e),console.log(e.getTracks());const n=document.createElement("audio");"srcObject"in n?n.srcObject=e:n.src=window.URL.createObjectURL(e),e.onended=()=>{t.removeChild(n)},t.appendChild(n),n.play()},n.subscribe(()=>{const t=n.getState();t.isremote&&(console.log("broadcast"),e.control(t.playerState))}),e.oncontrolmessage=t=>{n.dispatch({type:"CHANGE_STATE",playerState:t})}};function E(t,e,n,s,r){const i=new a.a;let c=null,d=document.getElementById("enteroom");const u=t=>{i.add(t,t=>{t.pause();const e=t.files.find(t=>t.name.endsWith(".mp4"));e?(c=t.magnetURI,d.disabled=!1,document.getElementById("torrentname").innerHTML="File to be played: "+e.name):alert("Forgot to mention, the player only supports .mp4 files which your torrent doesnt have, soooo \n you can't use this torrent"),t.destroy()}),document.getElementById("torrentname").innerHTML="Checking ..."};d.disabled=!0,d.onclick=()=>{if(null!==e.displayName){const o=new p(e.uid,e.displayName,s,n,c);r.pause(),r.navigate("/rooms/"+o.id),k(t,o),d=null,i.destroy()}},document.getElementById("magneturi").onchange=()=>{const t=document.getElementById("magneturi").value.trim()+"&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com";console.log(t),u(t)},o()(document.getElementById("dropzone"),t=>{var e;e=t[0],".torrent"===l.a.extname(e.name).toLowerCase()?u(t[0]):alert("Please use a torrent file")})}e.default=function(t,e,n,s=null){t.innerHTML=y()({isJoin:s});const o=navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1,echoCancellation:!0,noiseSuppression:!1}});window.Auth.onAuthStateChanged(r=>{!function(t){const e=document.getElementById("displayname");t.displayName&&(e.value=t.displayName),e.onchange=()=>{t.updateProfile({displayName:e.value}).then(()=>{})}}(r),document.getElementById("enteroom").disabled=!1,s?n.child(s).once("value",l=>{null===l.val()&&(e.navigate("/"),alert("Room Not Found")),o.then(e=>{!function(t,e,n,s,o){document.getElementById("enteroom").onclick=()=>{if(void 0!==e.displayName){const r=new p(e.uid,e.displayName,s,n,null,o);k(t,r)}}}(t,r,e,n,s)}).catch(t=>{alert(t)}),console.log("Joinroom mode")}):(o.then(s=>{E(t,r,s,n,e)}).catch(t=>{alert(t)}),console.log("createroommode"))})}}}]);