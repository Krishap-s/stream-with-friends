(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{49:function(t,e,n){var s=n(17);t.exports=(s.default||s).template({1:function(t,e,n,s,o){return"Join"},3:function(t,e,n,s,o){return"Create"},5:function(t,e,n,s,o){return'\t\t<div class="row">\n\n\t\t\t<div class="col-8 d-flex text-center flex-column mx-auto ">\n\t\t\t\t<label>Magnet URI:</label>\n\t\t\t\t<input id="magneturi" type="text" class="form-control mb-1" placeholder="magnet:?...">\n\t\t\t\t<h4 class="text-muted">OR</h4>\n\t\t\t\t<div id="dropzone" class="d-flex justify-content-center" style="height:40vh;border-style:dashed;border-color:grey;border-radius:20px">\n\t\t\t\t\t<h1 class="display-4 text-muted align-self-center">Drag And Drop Torrent File</h1>\n\t\t\t\t</div>\n\t\t\t\t<h4 id="torrentname" class="text-success"></h4>\n\t\t\t</div>\n\t\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){var l,r=null!=e?e:t.nullContext||{},i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n <div class="container">\n\t\t<div class="row" style="height:30vh">\n\t\t\t\n\t\t\t<div class="col-auto align-self-end mx-auto">\n\t\t\t\t<label>Display Name:</label>\n\t\t\t\t<input id="displayname" type="text" class="form-control ">\n\t\t\t</div>\n\n\t\t</div>\n\t\t<div class="row">\n\n\t\t\t<div class="col mx-auto">\n\t\t\t\t<div class="text-center">\n\t\t\t\t<button id="enteroombutt" disabled=true type="button" class="btn btn-outline-success btn-lg float-none mt-2 mb-3">'+(null!=(l=i(n,"if").call(r,null!=e?i(e,"isJoin"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:15,column:118},end:{line:15,column:157}}}))?l:"")+"</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n"+(null!=(l=i(n,"unless").call(r,null!=e?i(e,"isJoin"):e,{name:"unless",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:20,column:2},end:{line:33,column:13}}}))?l:"")+"\t</div>\n"},useData:!0})},50:function(t,e,n){var s=n(17);t.exports=(s.default||s).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){return'\t<div class="container-fluid" style="height:100vh;">\n\t\t<div class="d-flex flex-column h-100 p-1" >\n\t\t<div class="row mb-1">\n\t\t\t<div class="col-8">\n\t\t\t\t<video id="videlem" controls ></video>\n\t\t\t</div>\n\n\t\t\t<div class="col-4">\n\t\t\t\t<div class="card h-100">\n\t\t\t\t\t<div class="card-header">\n\t\t\t\t\t\t<h3 class="card-title"> Watchers : </h3> \n\t\t\t\t\t</div>\n\t\t\t\t\t<ul id="watchers" class="list-group list-group-flush">\n\t\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="row flex-grow-1">\n\t\t\t<div class="col-8">\n\t\t\t\t<div class="card h-100" >\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t<h3 class="card-title">Chat :</h3>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="col-4 align-self-center">\n\t\t\t\t<button id="mutebutt" type="button" data-toggle="button" class="btn btn-outline-secondary btn-lg mx-auto"> Mute </button>\n\t\t\t\t<button id="disconnectbutt" type="button" class="btn btn-outline-danger btn-lg mx-auto"> Disconnect </button>\n\t\t\t</div>\n\t\t</div>\n\t\t</div>\n\t</div>\n'},useData:!0})},51:function(t,e,n){var s=n(17);t.exports=(s.default||s).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){var l,r=null!=e?e:t.nullContext||{},i=t.hooks.helperMissing,a=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li id="'+a("function"==typeof(l=null!=(l=c(n,"uid")||(null!=e?c(e,"uid"):e))?l:i)?l.call(r,{name:"uid",hash:{},data:o,loc:{start:{line:1,column:8},end:{line:1,column:15}}}):l)+'" class="list-group-item d-inline-flex">'+a("function"==typeof(l=null!=(l=c(n,"displayName")||(null!=e?c(e,"displayName"):e))?l:i)?l.call(r,{name:"displayName",hash:{},data:o,loc:{start:{line:1,column:55},end:{line:1,column:70}}}):l)+' <button class="btn btn-info ml-auto give-remote" style="display: none;">Give Remote</button></li>'},useData:!0})},57:function(t,e,n){"use strict";n.r(e);var s=n(40),o=n.n(s),l=n(47),r=n.n(l),i=n(23),a=n.n(i),c=n(48),d=n.n(c);var u=class{constructor(t,e,n){this.fchannel=n;this.pc=new d.a({initiator:t,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpTransform:t=>(t.replace("useinbandfec=1","useinbandfec=1; maxaveragebitrate=28000"),t),trickle:!0,stream:e}),this.pc.on("signal",t=>{n.send(JSON.stringify(t))}),this.fchannel.onmessage=t=>{const e=JSON.parse(t);this.pc.signal(e)},this.pc.once("connect",()=>{n.onmessage=null,this.pc.removeAllListeners("signal")})}};var m=class{constructor(t,e){this.id=t,this.ref=e,this.onmessage=null,this.ref.on("child_added",t=>{const e=t.val();e.id!==this.id&&(this.onmessage&&this.onmessage(e.data),t.ref.remove())})}send(t){this.ref.push({id:this.id,data:t}).then(()=>{}).catch(t=>{console.error("Error writing new message to Firebase Database",t)})}destroy(){this.ref.off(),this.id=null,this.ref=null,this.onmessage=null}};var h=class{constructor(t,e,n,s,o=null,l=null){this.uid=t,this.stream=s,this.name=e,this.torrent=o,this.muted=!1,this.connList={},this.onuseradded=null,this.onuserconnected=null,this.remoteuser=null,this.oncontrolmessage=null,this.onmessage=null,this.onremoteuserset=null,this.ontorrentlearned=null,this.onremotestreamadded=null,this.onuserremoved=null,null===l?(this.roomRef=n.push(),this.roomRef.set({torrent:this.torrent,remoteiswith:this.uid}).then(()=>{this.ontorrentlearned&&this.ontorrentlearned(this.torrent),this.onremoteuserset&&this.onremoteuserset()}),this.roomRef.onDisconnect().remove(),this.id=this.roomRef.key):(this.roomRef=n.child(l),this.roomRef.child("torrent").once("value",t=>{this.torrent=t.val(),this.ontorrentlearned&&this.ontorrentlearned(this.torrent)})),this.roomRef.child("remoteiswith").on("value",t=>{t.val()===this.uid&&(Object.keys(this.connList).length?this.roomRef.child("remoteiswith").onDisconnect().set(Object.keys(this.connList)[0]):this.roomRef.onDisconnect().remove(),this.onremoteuserset&&this.onremoteuserset()),this.remoteuser=t.val()}),this.currentUser=this.roomRef.child("connList").child(this.uid),this.currentUser.set(this.name),this.currentUser.onDisconnect().remove(),this.roomRef.child("connList").on("child_added",t=>{if(t.key===this.uid)return;0===Object.keys(this.connList).length&&(this.roomRef.onDisconnect().cancel(),this.currentUser.onDisconnect().remove()),this.onuseradded&&this.onuseradded({uid:t.key,displayname:t.val()}),this.connList[t.key]={name:t.val()},this.uid===this.remoteuser&&this.roomRef.child("remoteiswith").onDisconnect().set(Object.keys(this.connList)[0]);const e=[t.key,this.uid];e.sort();const n=this.roomRef.child(`channels/${e[0]}/${e[1]}`),s=this.uid===e[0],o=new u(s,this.stream,new m(this.uid,n));o.pc.on("error",t=>{console.log(t)}),o.pc.once("connect",()=>{this.onuserconnected&&this.onuserconnected(o.pc),this.connList[t.key].peer=o,o.pc.on("data",e=>{e=JSON.parse(e),t.key===this.remoteuser&&"control"===e.type&&(this.oncontrolmessage?this.oncontrolmessage(e.data):this.onmessage&&this.onmessage({name:t.val(),data:e.data}))})}),o.pc.once("stream",t=>{this.onremotestreamadded&&this.onremotestreamadded(t)})}),this.roomRef.child("connList").on("child_removed",t=>{t.key!==this.uid&&(this.connList[t.key].peer.pc.destroy(),this.connList[t.key].peer=null,delete this.connList[t.key],this.onuserremoved&&this.onuserremoved(t.key))})}changeRemote(t){this.roomRef.child("remoteiswith").set(t),this.onremoteuserset&&this.onremoteuserset(),this.roomRef.child("remoteiswith").onDisconnect().cancel()}broadcast(t){const e=JSON.stringify({type:"message",data:t});Object.values(this.connList).forEach(t=>{console.log(t),t.peer.pc.send(e)})}control(t){const e=JSON.stringify({type:"control",data:t});Object.values(this.connList).forEach(t=>{console.log(t),t.peer.pc.send(e)})}toggleMute(){this.stream.getTracks().forEach(t=>{t.enabled=!t.enabled}),this.muted=!this.muted}disconnect(){Object.values(this.connList).forEach(t=>{t.peer.pc.destroy()}),this.roomRef.onDisconnect().cancel(),this.stream.getTracks().forEach(t=>t.stop()),this.currentUser.remove(),this.remoteuser===this.uid&&(Object.keys(this.connList).length?this.roomRef.child("remoteiswith").set(Object.keys(this.connList)[0]):this.roomRef.remove()),this.roomRef.child("connList").off(),this.roomRef.child("remoteiswith").off(),this.uid=null,this.stream=null,this.name=null,this.torrent=null,this.muted=null,this.connList={},this.onuseradded=null,this.onuserconnected=null,this.remoteuser=null,this.oncontrolmessage=null,this.onmessage=null,this.onremoteuserset=null,this.ontorrentlearned=null,this.onremotestreamadded=null,this.ondataremoved=null}},p=n(49),y=n.n(p),g=n(52),v=n(50),f=n.n(v);var b=class{constructor(t,e,n){this.vidElem=e,this.torrent=t,this.playerStore=n,this.Player=new Plyr(this.vidElem,{controls:'\n<div class="plyr__controls">\n<button type="button" class="plyr__control remote-only" aria-label="Play" data-plyr="play">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-pause"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-play"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Pause</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Play</span>\n</button>\n<div class="plyr__progress__container">\n<div class="plyr__progress">\n<input class="remote-only" data-plyr="seek" type="range" min="0" max="100" step="0.01" value="0" aria-label="Seek">\n<progress class="plyr__progress__buffer" min="0" max="100" value="0">% buffered</progress>\n<span role="tooltip" class="plyr__tooltip">00:00</span>\n</div>\n</div>\n<button type="button" class="plyr__control" aria-label="Mute" data-plyr="mute">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-muted"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-volume"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Unmute</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Mute</span>\n</button>\n<div class="plyr__volume">\n<input data-plyr="volume" type="range" min="0" max="1" step="0.05" value="1" autocomplete="off" aria-label="Volume">\n</div>\n<div class="plyr__controls__item plyr__time--current plyr__time" aria-label="Current time"></div>\n<button type="button" class="plyr__control" data-plyr="fullscreen">\n<svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-exit-fullscreen"></use></svg>\n<svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-enter-fullscreen"></use></svg>\n<span class="label--pressed plyr__tooltip" role="tooltip">Exit fullscreen</span>\n<span class="label--not-pressed plyr__tooltip" role="tooltip">Enter fullscreen</span>\n</button>\n</div>\n',clickToPlay:!1,keyboard:{global:!1,focus:!1}}),this.hideControls(),this.Player.on("play",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.Player.on("pause",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.Player.on("seeked",()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})}),this.interval=setInterval(()=>{this.playerStore.getState().isremote&&this.playerStore.dispatch({type:"CHANGE_STATE",playerState:{paused:this.Player.paused,currtime:this.Player.currentTime}})},3e3),this.Player.on("loadedmetadata",()=>{console.log("ready"),this.unsubscribe=this.playerStore.subscribe(()=>{const t=this.playerStore.getState();switch(console.log(t.isremote),t.isremote){case!0:this.showControls();break;default:this.hideControls()}if(!t.isremote&&t.isready){switch(t.playerState.paused){case!0:console.log("pausing"),this.Player.pause();break;default:console.log("playing"),this.Player.play()}const e=this.Player.currentTime-t.playerState.currtime;(e>.5||e<-.5)&&(this.Player.currentTime=t.playerState.currtime)}}),this.playerStore.dispatch({type:"READY"})}),this.client=new a.a,this.client.add(t,t=>{t.files.find(t=>t.name.endsWith(".mp4")).renderTo(this.vidElem,{controls:!1}),this.client.on("error",t=>{console.log(t)})})}hideControls(){document.querySelectorAll(".remote-only").forEach(t=>{t.style.display="none",console.log("Hiding Controls")})}showControls(){document.querySelectorAll(".remote-only").forEach(t=>{t.style.display="",console.log("Showing Controls")})}destroy(){clearInterval(this.interval),this.client.remove(this.torrent),this.client.destroy(),this.client=null,URL.revokeObjectURL(this.Player.source),this.Player.source=null,this.Player.destroy(),this.Player=null,this.unsubscribe(),this.vidElem=null,this.playerStore=null}};const E={isremote:!1,torrent:null,isready:!1,playerState:{paused:!0,currtime:0}};function w(t=E.playerState,e){return e}var k=function(t=E,e){switch(e.type){case"CHANGE_STATE":return{...t,playerState:w(t.playerState,e.playerState)};case"SET_REMOTE":return{...t,isremote:!t.isremote};case"TORRENT_LEARNED":return{...t,torrent:e.torrent};case"READY":return{...t,isready:!0};default:return t}},S=n(51),_=n.n(S);var R=function(t,e){const n=Object(g.a)(k);let s;t.innerHTML=f()(),e.ontorrentlearned=t=>{s=new b(t,document.getElementById("videlem"),n)},e.onremoteuserset=()=>{n.dispatch({type:"SET_REMOTE"}),document.querySelectorAll(".give-remote").forEach(t=>{console.log(t),"none"===t.style.display?(t.style.display="",t.onclick=()=>{e.changeRemote(t.parentElement.id),t.onclick=null}):t.style.display="none"})},e.onremotestreamadded=e=>{console.log(e),console.log(e.getTracks());const n=document.createElement("audio");"srcObject"in n?n.srcObject=e:n.src=window.URL.createObjectURL(e),e.onended=()=>{t.removeChild(n)},t.appendChild(n),n.play()};const o=n.subscribe(()=>{const t=n.getState();t.isremote&&e.control(t.playerState)});e.oncontrolmessage=t=>{n.dispatch({type:"CHANGE_STATE",playerState:t})},e.onuseradded=t=>{const{isremote:s}=n.getState(),o=_()({uid:t.uid,displayName:t.displayname}),l=document.createRange().createContextualFragment(o);l.lastElementChild.lastElementChild.onclick=()=>{e.changeRemote(t.uid),l.lastElementChild.lastElementChild.onclick=null},s&&(l.lastElementChild.lastElementChild.style=""),document.getElementById("watchers").appendChild(l)},e.onuserremoved=t=>{document.getElementById("watchers").removeChild(document.getElementById(t))},document.getElementById("mutebutt").onclick=()=>{const t=document.getElementById("mutebutt");e.muted?t.innerHTML="Mute":t.innerHTML="UNMute",e.toggleMute()},document.getElementById("disconnectbutt").onclick=()=>{e.disconnect(),s.destroy(),o(),window.router.resume(),window.router.navigate("/"),document.getElementById("mutebutt").onclick=null,document.getElementById("disconnectbutt").onclick=null}};function x(t,e,n,s){const l=new a.a;let i=null,c=null,d=document.getElementById("enteroombutt");const u=t=>{l.add(t,t=>{t.pause();const e=t.files.find(t=>t.name.endsWith(".mp4"));e?(c=t.magnetURI,d.disabled=!1,document.getElementById("torrentname").innerHTML="File to be played: "+e.name):alert("Forgot to mention, the player only supports .mp4 files which your torrent doesnt have, soooo \n you can't use this torrent"),t.destroy()}),document.getElementById("torrentname").innerHTML="Checking ..."};d.disabled=!0,d.onclick=()=>{if(""!==document.getElementById("displayname").value){i();const o=new h(e.uid,document.getElementById("displayname").value,s,n,c);window.router.pause(),window.router.navigate("/rooms/"+o.id),d.onclick=null,d=null,l.destroy(),R(t,o)}},document.getElementById("magneturi").onchange=()=>{const t=document.getElementById("magneturi").value.trim()+"&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com";console.log(t),u(t)},i=o()(document.getElementById("dropzone"),t=>{var e;e=t[0],".torrent"===r.a.extname(e.name).toLowerCase()?u(t[0]):alert("Please use a torrent file")})}e.default=function(t,e,n=null){t.innerHTML=y()({isJoin:n});const s=navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!1,echoCancellation:!0,noiseSuppression:!0,volume:.5}});window.Auth.onAuthStateChanged(o=>{!function(t){t.displayName&&(document.getElementById("enteroombutt").disabled=!1,document.getElementById("displayname").value=t.displayName),document.getElementById("displayname").onchange=()=>{t.updateProfile({displayName:document.getElementById("displayname").value}).then(()=>{}),""!==document.getElementById("displayname").value?document.getElementById("enteroombutt").disabled=!1:document.getElementById("enteroombutt").disabled=!0}}(o),n?e.child(n).once("value",l=>{null===l.val()&&(window.router.navigate("/"),alert("Room Not Found")),s.then(s=>{!function(t,e,n,s,o){document.getElementById("enteroombutt").onclick=()=>{if(document.getElementById("displayname").value){const l=new h(e.uid,document.getElementById("displayname").value,s,n,null,o);document.getElementById("enteroombutt").onclick=null,R(t,l)}}}(t,o,s,e,n)}).catch(t=>{alert(t)}),console.log("Joinroom mode")}):(s.then(n=>{x(t,o,n,e)}).catch(t=>{alert(t)}),console.log("createroommode"))})}}}]);